---
import { getCollection } from 'astro:content';

interface Props {
  currentSlug: string;
  currentSection: string;
}

const { currentSlug, currentSection } = Astro.props;
const allPages = await getCollection('pages');

const sections = [
  { id: 'foundation', label: 'Foundation', icon: 'ðŸ“š', dir: '01-foundation' },
  { id: 'retrieval-strategies', label: 'Retrieval Strategies', icon: 'ðŸ”', dir: '02-retrieval-strategies' },
  { id: 'graph-rag', label: 'Graph-Based RAG', icon: 'ðŸ•¸ï¸', dir: '03-graph-rag' },
  { id: 'rag-ontology', label: 'RAG Ontology', icon: 'ðŸ›ï¸', dir: '04-rag-ontology' },
  { id: 'synthesis', label: 'Synthesis', icon: 'ðŸŽ¯', dir: '04-synthesis' },
];

const groupedPages = sections.map(section => ({
  ...section,
  pages: allPages
    .filter(p => p.data.section === section.id)
    .sort((a, b) => a.data.order - b.data.order),
}));
---
<nav class="site-sidebar" aria-label="Site navigation">
  <div style="padding: 0.75rem 1.25rem; margin-bottom: 0.5rem;">
    <a href="/" style="font-weight: 700; font-size: 1.1rem; color: var(--color-text);">RAG Deep Dive</a>
  </div>
  {groupedPages.map(section => (
    <details class="nav-section" open={section.id === currentSection}>
      <summary class="nav-section-title">
        <span class="nav-section-icon">{section.icon}</span>
        <span class="nav-section-label">{section.label}</span>
        <span class="nav-section-count">({section.pages.length})</span>
      </summary>
      {section.pages.map(page => {
        const isActive = page.id.replace(/\.mdx?$/, '') === currentSlug;
        return (
          <a
            href={`/${page.id.replace(/\.mdx?$/, '')}`}
            class:list={['nav-link', { active: isActive }]}
          >
            <span class="nav-link-text">{page.data.title}</span>
            {isActive && <span class="nav-link-indicator">â†’</span>}
          </a>
        );
      })}
    </details>
  ))}
</nav>
